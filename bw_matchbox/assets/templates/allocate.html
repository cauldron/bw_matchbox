{% include 'header.html' %}

<div id="allocate-layout" class="__panels-layout allocate-layout">
  <div id="allocate-header" class="allocate-header">
    {% include 'navigation.html' %}
    <div class="common-page-header">
      <h3 class="title">
        {{ ds.name }}
        <div class="tools">
          <div class="tools-wrapper">
            <a id="test-button" class="tools-button theme-primary" title="Test button">Test Button</a>
            <a class="tools-icon theme-primary" title="Test icon"><i class="fa-solid fa-copy"></i></a>
          </div>
        </div>
      </h3>
    </div>
    <div class="info-tableau">
      {# TODO: Show some info/statistics here (to keep plcae for loader? #}
      <div class="error" id="error">Sample error text</div>
      <div id="loader-splash" class="loader-splash bg-white full-cover"><div class="loader-spinner"></div></div>
    </div>
  </div>
  <div id="allocate-columns-layout" class="allocate-columns-layout">
    <div id="allocate-groups-column" class="allocate-columns-layout-column allocate-groups-column">
      <p>allocate-groups-column</p>
    </div>
    <div id="allocate-sources-column" class="allocate-columns-layout-column allocate-sources-column">
      <p>allocate-sources-column</p>

      <h3>Technosphere Inputs</h3>

      {% if not technosphere|length %}
        <p>No technosphere exchanges</p>
      {% else %}
        <table class="fixed-table" width="100%">
          <thead>
            <tr>
              <th class="cell-amount"><div>Amount</div></th>
              <th class="cell-name"><div>Name</div></th>
              <th class="cell-location"><div>Location</div></th>
              <th class="cell-unit"><div>Unit</div></th>
            </tr>
          </thead>
          <tbody>
            {% for row in technosphere %}
              <!--
                {{ row|safe }}
              -->
            {#
              amount: 0.06008158208572887
              id: 199
              input: {name: 'Clay-Williams', unit: 'kilogram', location: 'GLO', product: 'LLC', categories: 'Unknown'}
              output: {name: 'Smith LLC', unit: 'kilogram', location: 'GLO', product: 'Inc', categories: 'Unknown'}
              type: "technosphere"
            #}
            <tr>
              <td><div>{{row.amount}}</div></td>
              <td><div><a href="{{ url_for('process_detail', id=row.id) }}">{{row.input.name}}</a></div></td>
              <td><div>{{row.input.location}}</div></td>
              <td><div>{{row.input.unit}}</div></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}


    </div>
  </div>
</div>

{# TODO: It's possible to dynamically load all required styles using `CommonHelpers.addCssStyle` method. #}
<link rel="stylesheet" href="{{ url_for('static', filename='css/allocate-page.css') }}">

<!-- Start page scripts -->
<script type="module">

  // @ts-check

  // Core module
  import { AllocatePage } from '/assets/modules/pages/AllocatePage/AllocatePage.js';

  // Global variables...
  const sharedParams = {
    // Current configuration parameters...
    currentRole: '{{ config.role }}',
    currentUser: '{{ config.user }}',
    // Data...
    production: {{ production_json|safe }},
    technosphere: {{ technosphere_json|safe }},
    biosphere: {{ biosphere_json|safe }},
  };

  console.log('[allocate]', sharedParams);

  // Export to global scope (to access from generated html code handlers).
  window.allocatePage = new AllocatePage(sharedParams);

</script>

{% include 'footer.html' %}
