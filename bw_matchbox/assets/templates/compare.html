{% include 'header.html' %}
<div class="container">
  {% include 'navigation.html' %}
  <span class="modal-wrapper">
    <div class="modal" id="number-editor">
      <div class="modal-content">
        <span class="close">&times;</span>
        <span id="modal-content-wrapper">Number Editor</span>
      </div>
    </div>
  </span>

  <div class="row">
    <div class="four columns">
      <h4>Location: {% if source_node.location == target_node.location %}Same{% else %}{{ source_node.location }} | {{ target_node.location }}{% endif %}</h4>
    </div>
    <div class="three columns">
      <h4>Unit: {% if source_node.unit == target_node.unit %}Same{% else %}{{ source_node.unit }} | {{ target_node.unit }}{% endif %}</h4>
    </div>
    <div class="five columns">
      <button class="button-primary" id="save-mapping-button">{% if proxy and proxy != "None" %}Create Proxy</button> <button class="button-primary" id="one-to-one">1-to-1 Proxy</button>{% else %}Save{% endif %}</button>
    </div>
  </div>
  <div class="row">
    <div class="column one-half">
      <h3>{{ source_node.name }}</h3>
      <table id="source-table">
      </table>
    </div>
    <div class="column one-half">
      <h3>{{ target_node.name }} <span onclick="compareLogic.replaceWithTarget(this)"><a><i class="fa-solid fa-arrow-up"></i></a></span></h3>
      <table id="target-table">
      </table>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/compare-logic.js') }}"></script>
<script>

// Global variables for compare tables feature (via global variable `compareData`)...
const compareData = {
  source_data: {{ source_data_json|safe }},
  target_data: {{ target_data_json|safe }},
  target_node: {{ target_json|safe}},
  source_id: {{ source_node.id }},
  target_id: {{ target_node.id }},
  target_name: '{{ target_node.name|safe }}',
  source_node_unit: '{{source_node.unit}}',
  source_node_location: '{{source_node.location}}',
  comment: '',
  // Row click data...
  rowClick: {
    timeout: 100,
    disabled: false,
    releaseHandler: undefined,
  },
  // Collpsing rows data...
  collapsed: {
    selectedFirst: undefined, // undefined | { kind: 'source' | 'target', rowEl: HTMLTableRowElement }
    selectedSecond: undefined, // undefined | { kind: 'source' | 'target', rowEl: HTMLTableRowElement }
  },
};

compareLogic.build_table('source-table', compareData.source_data, false);
compareLogic.build_table('target-table', compareData.target_data, true);

document.getElementById('save-mapping-button').addEventListener('click', compareLogic.createProxyFunc, false);
document.getElementById('one-to-one').addEventListener('click', compareLogic.createOneToOneProxyFunc, false);

var modal = document.getElementById('number-editor');

var closer = document.getElementsByClassName('close')[0];
if (closer) {
  closer.onclick = compareLogic.hideModal;
}

</script>
{% include 'footer.html' %}
