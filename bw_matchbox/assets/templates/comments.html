{% include 'header.html' %}

{# Module-specific dependencies... #}

<link rel="stylesheet" href="{{ url_for('static', filename='css/comments.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/comments-filters.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/comments-threads-list.css') }}">

<script src="{{ url_for('static', filename='js/Comments/Comments.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsConstants.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsData.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsDataRender.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsHandlers.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsHelpers.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsLoader.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsNodes.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsPrepareLoadedData.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsStates.js') }}"></script>
<script src="{{ url_for('static', filename='js/Comments/CommentsThreadsHelpers.js') }}"></script>

{# Core module:
  - `Comments` (from `bw_matchbox/assets/js/Comments/Comments.js`)
#}

<div id="comments-root" class="comments-root container empty loading">
  {# // TODO: Do we need `navigation` block here?
  #}
  {% include 'navigation.html' %}
  <div class="common-page-header">
    <h3 class="title">
      Comments
      {#
      <div class="tools">
        <div class="tools-wrapper">
          <a class="tools-icon theme-primary" onClick="Comments.copyToClipboardHandler(this)" data-node-type="source" title="Copy markdown link to clipboard"><i class="fa-solid fa-copy"></i></a>
        </div>
      </div>
      #}
    </h3>
  </div>
  <div class="filters">
    <div id="filterItemByState" class="filter-item">
      <label for="filterByState">Resolved state:</label>
      <select id="filterByState" size="5" onChange="Comments.handlers.handleFilterByStateChange(this)">
        <option value="none" selected>All</option>
        <option value="resolved">Resolved</option>
        <option value="open">Open</option>
      </select>
    </div>
    <div id="filterItemByUsers" class="filter-item">
      <label for="filterByUsers">Filter by user:</label>
      <select id="filterByUsers" multiple onChange="Comments.handlers.handleFilterByUserChange(this)">
      </select>
    </div>
    <div id="filterItemByProcesses" class="filter-item">
      <label for="filterByProcesses">Filter by process:</label>
      <select id="filterByProcesses" multiple onChange="Comments.handlers.handleFilterByProcessChange(this)">
      </select>
    </div>
    <div id="filterItemResetAll" class="filter-item">
      <label>&nbsp;</label>
      <button class="button-primary" onClick="Comments.handlers.handleResetFilters(this)">Reset all filters</button>
    </div>
    <div class="debug-info">
      <div>+ Resolved state (no filter, resolved, open)</div>
      <div>- Process (Can be a select element with multiple)</div>
      <div>? Author (Again a select element)</div>
      <div>? Participants</div>
      <div>+ Reset</div>
      <div>- My comment threads</div>
    </div>
  </div>
  <div id="comments-error" class="error">
    <!-- Error text comes here -->
  </div>

  <div id="threads-list-empty" class="threads-list-empty">No data has loaded</div>
  <div id="threads-list" class="threads-list">Data...</div>
  <div class="bottom-actions">
    {# // TODO: Is these actions required here?
    <div class="bottom-actions-links">
      <a id="action-reload-random" onClick="Comments.handlers.clearAndReloadData(this)">Reload random data</a>
      <a id="action-load-more" onClick="Comments.handlers.loadMoreData(this)">Load more<span id="available-records-info"></span></a>
      <a id="action-clear-and-reload" onClick="Comments.handlers.clearAndReloadData(this)">Reload</a>
      <span id="show-total-comments-number">Loaded all the available comments (<span id="total-comments-number"></span>)</span>
    </div>
    #}
    <div id="loader-splash" class="loader-splash full-cover"><div class="loader-spinner"></div></div>
  </div>

</div>

<script type="text/javascript">
  modules.require(['Comments', 'CommentsConstants'], (Comments, CommentsConstants) => {
    const { useDebug } = CommentsConstants;
    // Initialize page data...
    const sharedParams = {
      base_url: '{{ base_url }}',
      role: '{{ config.role }}',
      user: /*DEBUG: To test local fake dataset */ useDebug ? 'Puccio Bernini' :
        '{{ config.user }}',
    };

    // Export to global scope (to access from generated html code handlers).
    window.Comments = Comments;

    // Start core module...
    Comments.start(sharedParams);
  });
</script>
{% include 'footer.html' %}
